use Bend/Compile/NetToHvm as C

// Converts a Bend Net to an HVM Net.
// - net: The Bend Net to convert.
// = The converted HVM Net or an error message.
Bend/Compile/NetToHvm/net-to-hvm : Bend/Net -> (Bend Bend/Hvm/Net)
| #Net{nam nod len} = do Bend {
  let net           = #Net{nam nod len}
  let rdx           = (C/get-rdx net)
  let st            = (C/State/new len)
  ask rot           = (Maybe/to-result (Bend/Net/get-port net Bend/Net/net-root) "Failed to get root port")
  ask #Pair{rot st} = (var-or-subtree-to-hvm net rot st)
  ask rbag          = (go redexes state)
  #Done{#Net{nam rot rbag}}
}

go : Bend/Net -> (List (Pair U64 U64)) -> C/State -> (Bend (List Bend/Hvm/Redex))
| net #Nil st = #Done{#Nil}
| net #Cons{#Pair{a b} rdxs} st = do Bend {
  ask #Pair{a st} = (C/tree-to-hvm net a st)
  ask #Pair{b st} = (C/tree-to-hvm net b st)
  let rdx         = #Redex{a b}
  ask rdxs        = (go net rdxs st)
  #Done{#Cons{rdx rdxs}}
}
